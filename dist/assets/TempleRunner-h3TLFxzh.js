import{r as L,j as h,_ as ze}from"./index-DxoVmnoF.js";import{B as De}from"./BackButton-rhTEpRQT.js";function Ce(){const S=L.useRef(null),[H,U]=L.useState("menu"),[pe,te]=L.useState(0),[ue,oe]=L.useState(0),[we,ne]=L.useState(1),[fe,Me]=L.useState(0),[ge,xe]=L.useState(0),[Se,ye]=L.useState(()=>Number(localStorage.getItem("templeRunnerBest")||0)),[ve,se]=L.useState("Jungle Temple"),Z=L.useRef({});return L.useEffect(()=>{let a,i,x,z,g,ie,C,_,X;const d={lanes:[-2,0,2],segLen:20,initSegs:12,worldSpeed:.22,maxSpeed:.7,speedInc:.015,obsSpawnDist:25,coinChance:.7,slideDur:.55,gravity:-.03,jumpVel:.38,camY:4.7,camZ:8.8},Q=[{name:"Jungle Temple",sky:329746,ground:8020554,wall:4139804,fog:329746},{name:"Desert Ruins",sky:1709072,ground:12888170,wall:9139029,fog:2760208},{name:"Ancient Ruins",sky:657938,ground:6975605,wall:3817285,fog:1381658},{name:"Lava Depths",sky:1705221,ground:4857888,wall:2756624,fog:2755082},{name:"Frozen Temple",sky:659220,ground:10338255,wall:5929610,fog:988185}],ae=[0,3e3,6e3,9e3,12e3];let b=[],j=[],P=[],I=[],t,m,D,W=-40,q=0,$=0;function re(){return{started:!1,over:!1,speed:d.worldSpeed,dist:0,coins:0,mult:1,best:Number(localStorage.getItem("templeRunnerBest")||0),shakeTime:0,shieldTime:0,magnetTime:0,biomeIdx:0}}function le(){return{lane:1,targetLane:1,jumping:!1,jumpV:0,sliding:!1,slideT:0,runT:0}}function ce(){return{distZ:-12,runT:0}}async function be(){a=await ze(()=>import("./three.module-Ck8estzQ.js"),[],import.meta.url),i=new a.Scene,i.background=new a.Color(329746),i.fog=new a.Fog(329746,6,130),x=new a.PerspectiveCamera(75,S.current.clientWidth/S.current.clientHeight,.1,1e3),x.position.set(0,d.camY,d.camZ),x.lookAt(0,1.2,-10),z=new a.WebGLRenderer({antialias:!0,powerPreference:"high-performance"}),z.setSize(S.current.clientWidth,S.current.clientHeight),z.setPixelRatio(Math.min(window.devicePixelRatio,2)),z.shadowMap.enabled=!0,S.current.appendChild(z.domElement),i.add(new a.AmbientLight(16777215,.35));const e=new a.DirectionalLight(16773845,.9);e.position.set(10,18,10),e.castShadow=!0,e.shadow.mapSize.set(1024,1024),i.add(e),[[-3.5,3,5],[3.5,3,5]].forEach(s=>{const p=new a.PointLight(16755251,.9,25);p.position.set(...s),i.add(p);const w=new a.CylinderGeometry(.05,.15,1,8),r=new a.MeshStandardMaterial({color:3877399}),f=new a.Mesh(w,r);f.position.set(s[0],s[1]-.5,s[2]),i.add(f);const M=new a.SphereGeometry(.25,8,8),y=new a.MeshBasicMaterial({color:16755251,transparent:!0,opacity:.85}),B=new a.Mesh(M,y);B.position.set(s[0],s[1]+.2,s[2]),i.add(B)});const n=new a.BoxGeometry(.7,6,.7),c=new a.MeshStandardMaterial({color:4139804,roughness:.8});for(let s=0;s<20;s++){const p=-s*22-25,w=new a.Mesh(n,c);w.position.set(-6.5,3,p),w.castShadow=!0,i.add(w);const r=w.clone();if(r.position.x=6.5,i.add(r),s%2===0){const f=new a.BoxGeometry(13,.7,.5),M=new a.MeshStandardMaterial({color:4929059}),y=new a.Mesh(f,M);y.position.set(0,5.8,p),i.add(y)}}g=Ge(a),i.add(g),ie=g.userData,C=je(a),i.add(C),_=C.userData,t=re(),m=le(),D=ce(),g.position.set(d.lanes[1],1,0),C.position.set(0,1,-12);for(let s=0;s<d.initSegs;s++)ee(-s*d.segLen);q=performance.now()/1e3+10+Math.random()*8,$=performance.now();const u=()=>{S.current&&(x.aspect=S.current.clientWidth/S.current.clientHeight,x.updateProjectionMatrix(),z.setSize(S.current.clientWidth,S.current.clientHeight))};window.addEventListener("resize",u),Z.current.cleanup=()=>{var s;window.removeEventListener("resize",u),cancelAnimationFrame(X),z.dispose(),S.current&&((s=z.domElement)==null?void 0:s.parentNode)===S.current&&S.current.removeChild(z.domElement)},X=requestAnimationFrame(de)}function Ge(e){const n=new e.Group,c=new e.Mesh(new e.BoxGeometry(.7,1.1,.4),new e.MeshStandardMaterial({color:5190690}));c.position.y=1.2,c.castShadow=!0;const u=new e.Mesh(new e.SphereGeometry(.32,12,12),new e.MeshStandardMaterial({color:16765859}));u.position.y=2.1,u.castShadow=!0;const s=new e.Mesh(new e.TorusGeometry(.34,.06,8,16),new e.MeshStandardMaterial({color:3811865}));s.rotation.x=Math.PI/2,s.position.y=2.07;const p=new e.Mesh(new e.BoxGeometry(.72,.12,.42),new e.MeshStandardMaterial({color:9202479,metalness:.25}));p.position.y=.68;const w=new e.BoxGeometry(.25,.8,.25),r=new e.MeshStandardMaterial({color:1785195}),f=new e.Mesh(w,r);f.position.set(-.18,.4,0),f.castShadow=!0;const M=f.clone();M.position.x=.18;const y=new e.BoxGeometry(.28,.2,.35),B=new e.MeshStandardMaterial({color:1118481}),F=new e.Mesh(y,B);F.position.set(-.18,.1,.1);const E=F.clone();E.position.x=.18;const O=new e.BoxGeometry(.18,.5,.18),T=new e.MeshStandardMaterial({color:16765859}),v=new e.Mesh(O,T);v.position.set(-.45,1.6,0);const k=v.clone();k.position.x=.45;const Y=new e.BoxGeometry(.16,.5,.16),R=new e.Mesh(Y,T);R.position.set(-.55,1.2,.1);const N=R.clone();N.position.x=.55;const J=new e.SphereGeometry(.95,12,12),o=new e.MeshBasicMaterial({color:57599,transparent:!0,opacity:0,blending:e.AdditiveBlending}),l=new e.Mesh(J,o);return l.position.y=1.3,n.add(c,u,s,p,f,M,F,E,v,k,R,N,l),n.userData={torso:c,head:u,ll:f,rl:M,lua:v,rua:k,lfa:R,rfa:N,shield:l},n}function je(e){const n=new e.Group,c=new e.MeshStandardMaterial({color:2236962,metalness:.2}),u=new e.Mesh(new e.BoxGeometry(.9,1.3,.5),c);u.position.y=1.3,u.castShadow=!0;const s=new e.Mesh(new e.BoxGeometry(1.2,.3,.5),c);s.position.y=1.9;const p=new e.MeshStandardMaterial({color:1118481,emissive:2228224,emissiveIntensity:.7}),w=new e.Mesh(new e.BoxGeometry(.5,.6,.3),p);w.position.y=2.4,w.castShadow=!0;const r=new e.ConeGeometry(.12,.4,8),f=new e.MeshStandardMaterial({color:5910296}),M=new e.Mesh(r,f);M.position.set(-.2,2.7,0),M.rotation.z=Math.PI/8;const y=M.clone();y.position.x=.2,y.rotation.z=-Math.PI/8;const B=new e.Mesh(new e.BoxGeometry(.5,.2,.3),new e.MeshStandardMaterial({color:3611664}));B.position.set(0,2.1,.15);const F=new e.BoxGeometry(.2,.9,.2),E=new e.Mesh(F,c);E.position.set(-.6,1.3,0),E.castShadow=!0;const O=E.clone();O.position.x=.6;const T=new e.BoxGeometry(.28,.8,.28),v=new e.Mesh(T,c);v.position.set(-.22,.4,0),v.castShadow=!0;const k=v.clone();return k.position.x=.22,n.add(u,s,w,M,y,B,E,O,v,k),n.userData={body:u,head:w,lh:M,rh:y,jaw:B,la:E,ra:O,ll:v,rl:k},n}function ee(e){const n=a,c=Q[t?t.biomeIdx:0],u=new n.BoxGeometry(8,.4,d.segLen),s=new n.MeshStandardMaterial({color:c.ground,roughness:.9}),p=new n.Mesh(u,s);p.position.set(0,-.2,e),p.receiveShadow=!0,b.push(p),i.add(p);const w=new n.BoxGeometry(.5,2.5,d.segLen),r=new n.MeshStandardMaterial({color:c.wall,roughness:.9}),f=new n.Mesh(w,r);f.position.set(-4.25,1.1,e),b.push(f),i.add(f);const M=f.clone();M.position.x=4.25,b.push(M),i.add(M)}function V(e,n,c=!1){const u=a,s=c?.6:1.7,p=new u.BoxGeometry(.9,s,.9),w=new u.MeshStandardMaterial({color:c?7353105:9109504,roughness:.6}),r=new u.Mesh(p,w);r.position.set(d.lanes[e],s/2,n),r.castShadow=!0,r.userData={lane:e,low:c},j.push(r),i.add(r)}function Be(e){const n=Math.floor(Math.random()*4);if(n===0)V(Math.floor(Math.random()*3),e);else if(n===1)V(0,e),V(2,e);else if(n===2)V(1,e),V(Math.random()<.5?0:2,e);else for(let c=0;c<3;c++)V(c,e,!0);Math.random()<d.coinChance&&Ee(e-6)}function Ee(e){const n=a,c=Math.floor(Math.random()*3),u=d.lanes[c];for(let s=0;s<4;s++){const p=new n.CylinderGeometry(.35,.35,.08,16),w=new n.MeshStandardMaterial({color:16766720,metalness:.8,roughness:.25,emissive:7820544,emissiveIntensity:.6}),r=new n.Mesh(p,w);r.position.set(u,1.35,e-s*2),r.rotation.x=Math.PI/2,r.userData={spin:.15+Math.random()*.15},P.push(r),i.add(r)}}function Le(e){const n=a,c=Math.random()<.5?"shield":"magnet",u=Math.floor(Math.random()*3),s=d.lanes[u];let p,w;c==="shield"?(p=new n.SphereGeometry(.45,12,12),w=new n.MeshStandardMaterial({color:65535,emissive:13158,emissiveIntensity:1,transparent:!0,opacity:.85})):(p=new n.TorusGeometry(.4,.16,10,20),w=new n.MeshStandardMaterial({color:16711748,emissive:3342344,emissiveIntensity:.9,metalness:.7}));const r=new n.Mesh(p,w);r.position.set(s,1.5,e),r.userData={type:c},I.push(r),i.add(r)}function de(e){const n=Math.min((e-$)/1e3,.1);if($=e,t&&t.started&&!t.over){t.speed=Math.min(d.maxSpeed,t.speed+d.speedInc*n),t.dist+=t.speed*9*t.mult;const c=Math.floor(t.dist),u=1+Math.min(4,Math.floor(c/1800));u!==t.mult&&(t.mult=u,ne(u)),te(c);let s=0;for(let o=ae.length-1;o>=0;o--)if(c>=ae[o]){s=o;break}if(s!==t.biomeIdx&&s<Q.length){t.biomeIdx=s;const o=Q[s];i.background=new a.Color(o.sky),i.fog=new a.Fog(o.fog,6,130),se(o.name)}t.shieldTime>0&&(t.shieldTime-=n,t.shieldTime<0&&(t.shieldTime=0)),t.magnetTime>0&&(t.magnetTime-=n,t.magnetTime<0&&(t.magnetTime=0));for(let o=b.length-1;o>=0;o--)b[o].position.z+=t.speed,b[o].position.z>25&&(i.remove(b[o]),b.splice(o,1));for(;b.length<d.initSegs*3;){const o=b[b.length-1];ee((o?o.position.z:0)-d.segLen)}for(;0-W>d.obsSpawnDist;)Be(W-d.obsSpawnDist),W-=d.obsSpawnDist;for(let o=j.length-1;o>=0;o--)j[o].position.z+=t.speed,j[o].rotation.y+=.02,j[o].position.z>15&&(i.remove(j[o]),j.splice(o,1));for(let o=P.length-1;o>=0;o--){const l=P[o];if(l.position.z+=t.speed,l.rotation.z+=l.userData.spin,t.magnetTime>0){const G=g.position.x-l.position.x,A=g.position.z-l.position.z,K=Math.sqrt(G*G+A*A);K<6&&K>.01&&(l.position.x+=G/K*14*n,l.position.z+=A/K*14*n)}l.position.z>15&&(i.remove(l),P.splice(o,1))}const p=performance.now()/1e3;p>=q&&(Le(W-d.obsSpawnDist-10),q=p+10+Math.random()*8);for(let o=I.length-1;o>=0;o--){const l=I[o];l.position.z+=t.speed,l.rotation.y+=1.5*n,l.position.y=1.5+.2*Math.sin(p*5),l.position.z>15&&(i.remove(l),I.splice(o,1))}const w=d.lanes[m.targetLane];g.position.x+=(w-g.position.x)*10*n,m.jumping&&(g.position.y+=m.jumpV,m.jumpV+=d.gravity,g.position.y<=1&&(g.position.y=1,m.jumping=!1,m.jumpV=0)),m.sliding&&(m.slideT-=n,m.slideT<=0&&(m.sliding=!1)),m.runT+=n*9;const r=Math.sin(m.runT),{torso:f,head:M,ll:y,rl:B,lua:F,rua:E,lfa:O,rfa:T,shield:v}=ie;m.sliding?(f.position.y=.9,M.position.y=1.7,y.rotation.x=B.rotation.x=.2,F.rotation.x=E.rotation.x=O.rotation.x=T.rotation.x=0):(y.rotation.x=.7*r,B.rotation.x=-.7*r,F.rotation.x=.6*-r,E.rotation.x=.6*r,O.rotation.x=.3*Math.max(0,r),T.rotation.x=.3*Math.max(0,-r),f.position.y=1.2+.04*Math.abs(r),M.position.y=2.1+.03*Math.abs(r)),t.shieldTime>0?(v.material.opacity=.35+.25*Math.sin(t.shieldTime*8),v.scale.setScalar(1+.05*Math.sin(t.shieldTime*8))):v.material.opacity=0,g.position.z=0;const k=c>=6e3,Y=k?-9:-12;D.distZ+=((Y-D.distZ)*.25+t.speed*(k?1.05:.94))*n*-1,D.distZ=Math.max(Y-5,Math.min(-2,D.distZ)),C.position.x+=(g.position.x-C.position.x)*3*n,C.position.z=D.distZ,C.position.y=1,D.runT+=n*9.5;const R=Math.sin(D.runT);_.ll.rotation.x=.5*R,_.rl.rotation.x=-.5*R,_.la.rotation.x=.4*-R,_.ra.rotation.x=.4*R,_.head.position.y=2.4+.03*Math.abs(R);const N=g.position.x,J=g.position.y;D.distZ>=-2&&t.shieldTime<=0&&he();for(let o=0;o<j.length;o++){const l=j[o];if(Math.abs(N-l.position.x)<.8&&Math.abs(0-l.position.z)<.8){let G=!1;if(l.userData.low&&!m.sliding&&(G=!0),!l.userData.low&&J<1.8&&(G=!0),G)if(t.shieldTime>0)t.shieldTime=Math.max(0,t.shieldTime-1.5),i.remove(l),j.splice(o,1),o--;else{he();break}}}for(let o=P.length-1;o>=0;o--){const l=P[o],G=N-l.position.x,A=0-l.position.z;G*G+A*A<.64&&(t.coins++,t.dist+=12*t.mult,oe(t.coins),i.remove(l),P.splice(o,1))}for(let o=I.length-1;o>=0;o--){const l=I[o],G=N-l.position.x,A=0-l.position.z;G*G+A*A<.81&&(l.userData.type==="shield"?t.shieldTime=7:t.magnetTime=7,i.remove(l),I.splice(o,1))}if(x.position.y+=(d.camY+.5*(J-1)-x.position.y)*.09,x.position.z+=(d.camZ-x.position.z)*.09,x.position.x+=(N-x.position.x)*.09,t.shakeTime>0){t.shakeTime-=n;const o=.16*(t.shakeTime/.25);x.position.x+=(Math.random()-.5)*o,x.position.y+=(Math.random()-.5)*o}x.lookAt(N,J+.5,-8)}z.render(i,x),X=requestAnimationFrame(de)}function he(){t.over=!0,t.started=!1,t.shakeTime=.25;const e=Math.floor(t.dist);Me(e),xe(t.coins),e>t.best&&(t.best=e,localStorage.setItem("templeRunnerBest",String(e))),ye(t.best),U("over")}Z.current.start=()=>{t&&(t.started=!0),U("playing")},Z.current.restart=()=>{j.forEach(e=>i.remove(e)),P.forEach(e=>i.remove(e)),b.forEach(e=>i.remove(e)),I.forEach(e=>i.remove(e)),j=[],P=[],b=[],I=[],t=re(),m=le(),D=ce(),W=-40,q=performance.now()/1e3+10+Math.random()*8,g.position.set(d.lanes[1],1,0),C.position.set(0,1,-12),i.background=new a.Color(329746),i.fog=new a.Fog(329746,6,130);for(let e=0;e<d.initSegs;e++)ee(-e*d.segLen);te(0),oe(0),ne(1),se("Jungle Temple"),U("instructions")};const me=e=>{if(e.code==="Space"||e.code==="Enter"){if(H==="over"||t&&t.over){Z.current.restart();return}if(!t||!t.started){Z.current.start();return}}!t||!t.started||t.over||(e.code==="ArrowLeft"&&m.targetLane>0&&m.targetLane--,e.code==="ArrowRight"&&m.targetLane<2&&m.targetLane++,e.code==="ArrowUp"&&!m.jumping&&!m.sliding&&(m.jumping=!0,m.jumpV=d.jumpVel),e.code==="ArrowDown"&&!m.sliding&&!m.jumping&&(m.sliding=!0,m.slideT=d.slideDur))};return window.addEventListener("keydown",me),be(),()=>{var e,n;window.removeEventListener("keydown",me),(n=(e=Z.current).cleanup)==null||n.call(e)}},[]),h.jsxs("div",{className:"tr-root",children:[h.jsx("div",{ref:S,className:"tr-container"}),H==="menu"&&h.jsxs("div",{className:"tr-menu",children:[h.jsx("h1",{children:"Temple Runner 3D"}),h.jsx("p",{className:"tr-sub",children:"Run, jump, slide and survive the jungle temple."}),h.jsx("button",{className:"tr-play-btn",onClick:()=>U("instructions"),children:"Play"}),h.jsxs("div",{className:"tr-tips",children:[h.jsx("p",{children:h.jsx("strong",{children:"Controls"})}),h.jsx("p",{children:"← / → : Switch lanes"}),h.jsx("p",{children:"↑ : Jump   ↓ : Slide"}),h.jsx("p",{children:"SPACE / ENTER : Start"})]})]}),H==="instructions"&&h.jsxs("div",{className:"tr-instructions",children:[h.jsx("h3",{children:"Temple Runner"}),h.jsx("p",{children:"← / → lanes   ↑ jump   ↓ slide"}),h.jsx("p",{children:"Press SPACE or ENTER to start"}),h.jsx("button",{className:"tr-go-btn",onClick:()=>{var a,i;return(i=(a=Z.current).start)==null?void 0:i.call(a)},children:"GO!"})]}),H==="playing"&&h.jsxs("div",{className:"tr-hud",children:[h.jsxs("div",{className:"tr-hud-item gold",children:["Score: ",pe]}),h.jsxs("div",{className:"tr-hud-item coin",children:["Coins: ",ue]}),h.jsxs("div",{className:"tr-hud-item mult",children:["x",we]}),h.jsx("div",{className:"tr-hud-item biome",children:ve})]}),H==="over"&&h.jsxs("div",{className:"tr-gameover",children:[h.jsx("h2",{children:"Game Over!"}),h.jsxs("p",{children:["Score: ",fe]}),h.jsxs("p",{children:["Coins: ",ge]}),h.jsxs("p",{className:"tr-best",children:["Best: ",Se]}),h.jsx("button",{onClick:()=>{var a,i;return(i=(a=Z.current).restart)==null?void 0:i.call(a)},children:"Restart"})]}),h.jsx(De,{})]})}export{Ce as default};
