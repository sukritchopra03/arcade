import{r as h,R as M,j as s}from"./index-CRqe24Pj.js";import{B as T}from"./BackButton-DJX8SMkP.js";function b(){return Array.from({length:4},()=>Array(4).fill(0))}function j(n){const e=[];for(let l=0;l<4;l++)for(let a=0;a<4;a++)n[l][a]===0&&e.push([l,a]);if(e.length===0)return n;const[t,r]=e[Math.floor(Math.random()*e.length)],u=n.map(l=>[...l]);return u[t][r]=Math.random()<.9?2:4,u}function G(n){let e=n.filter(r=>r!==0),t=0;for(let r=0;r<e.length-1;r++)e[r]===e[r+1]&&(e[r]*=2,t+=e[r],e[r+1]=0);for(e=e.filter(r=>r!==0);e.length<4;)e.push(0);return{row:e,score:t}}function p(n){let e=0;return{grid:n.map(r=>{const{row:u,score:l}=G([...r]);return e+=l,u}),score:e}}function i(n){const e=b();for(let t=0;t<4;t++)for(let r=0;r<4;r++)e[r][3-t]=n[t][r];return e}function N(n){let e=i(i(n));const t=p(e);return e=i(i(t.grid)),{grid:e,score:t.score}}function R(n){let e=i(i(i(n)));const t=p(e);return e=i(t.grid),{grid:e,score:t.score}}function E(n){let e=i(n);const t=p(e);return e=i(i(i(t.grid))),{grid:e,score:t.score}}function B(n){for(let e=0;e<4;e++)for(let t=0;t<4;t++)if(n[e][t]===0||t<3&&n[e][t]===n[e][t+1]||e<3&&n[e][t]===n[e+1][t])return!0;return!1}function C(n,e){for(let t=0;t<4;t++)for(let r=0;r<4;r++)if(n[t][r]!==e[t][r])return!1;return!0}const I={0:"#1a2040",2:"#eee4da",4:"#ede0c8",8:"#f2b179",16:"#f59563",32:"#f67c5f",64:"#f65e3b",128:"#edcf72",256:"#edcc61",512:"#edc850",1024:"#edc53f",2048:"#edc22e"},O=new Set([0,2,4]);function Y(){const[n,e]=h.useState(()=>j(j(b()))),[t,r]=h.useState(0),[u,l]=h.useState(()=>parseInt(localStorage.getItem("2048_best")||"0")),[a,S]=h.useState(!1),[w,v]=h.useState(!1),f=h.useCallback(o=>{a||e(c=>{const{grid:g,score:L}=o(c);if(C(c,g))return c;const y=j(g);r(x=>{const d=x+L;return d>u&&(l(d),localStorage.setItem("2048_best",d)),d});for(let x=0;x<4;x++)for(let d=0;d<4;d++)y[x][d]===2048&&!w&&v(!0);return B(y)||S(!0),y})},[a,w,u]);h.useEffect(()=>{const o=c=>{c.key==="ArrowLeft"&&(c.preventDefault(),f(p)),c.key==="ArrowRight"&&(c.preventDefault(),f(N)),c.key==="ArrowUp"&&(c.preventDefault(),f(R)),c.key==="ArrowDown"&&(c.preventDefault(),f(E))};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[f]);const m=M.useRef(null),A=o=>{m.current={x:o.touches[0].clientX,y:o.touches[0].clientY}},D=o=>{if(!m.current)return;const c=o.changedTouches[0].clientX-m.current.x,g=o.changedTouches[0].clientY-m.current.y;Math.abs(c)>Math.abs(g)?c>30?f(N):c<-30&&f(p):g>30?f(E):g<-30&&f(R),m.current=null},k=()=>{e(j(j(b()))),r(0),S(!1),v(!1)};return s.jsxs("div",{className:"g2-root",onTouchStart:A,onTouchEnd:D,children:[s.jsx("h1",{children:"2048"}),s.jsxs("div",{className:"g2-scores",children:[s.jsxs("div",{className:"g2-sc",children:["Score",s.jsx("br",{}),s.jsx("strong",{children:t})]}),s.jsxs("div",{className:"g2-sc",children:["Best",s.jsx("br",{}),s.jsx("strong",{children:u})]}),s.jsx("button",{onClick:k,children:"New Game"})]}),s.jsx("div",{className:"g2-board",children:n.flat().map((o,c)=>s.jsx("div",{className:`g2-tile ${o>0?"pop":""}`,style:{background:I[o]||"#3c3a32",color:O.has(o)?"#776e65":"#f9f6f2",fontSize:o>=1024?"1.5rem":o>=128?"1.8rem":"2.2rem"},children:o>0?o:""},c))}),s.jsx("p",{className:"g2-hint",children:"Use arrow keys or swipe"}),a&&s.jsxs("div",{className:"g2-over",children:[s.jsx("h2",{children:"Game Over!"}),s.jsxs("p",{children:["Score: ",t]}),s.jsx("button",{onClick:k,children:"Try Again"})]}),w&&!a&&s.jsxs("div",{className:"g2-win",children:[s.jsx("h2",{children:"ðŸŽ‰ 2048!"}),s.jsx("p",{children:"You reached 2048!"}),s.jsx("button",{onClick:()=>v(!1),children:"Keep Playing"})]}),s.jsx(T,{})]})}export{Y as default};
