import{r as s,j as n}from"./index-CRqe24Pj.js";import{B as D}from"./BackButton-DJX8SMkP.js";const c=480,r=600,u=40,M=20,m=3,p=12,y=30,h=20,H=8,P=4,b=10;function U(){const j=s.useRef(null),[A,w]=s.useState(0),[B,L]=s.useState(3),[T,R]=s.useState(1),[N,x]=s.useState(!1),i=s.useRef(null),S=s.useCallback((E=1)=>{var v,d;const k=[];for(let o=0;o<P;o++)for(let f=0;f<H;f++)k.push({x:40+f*(y+b),y:40+o*(h+b),alive:!0,type:o});return{px:c/2-u/2,bullets:[],aliens:k,alienBullets:[],alienDir:1,alienSpeed:.3+E*.15,alienTimer:0,alienShootTimer:0,keys:{},score:((v=i.current)==null?void 0:v.score)||0,lives:((d=i.current)==null?void 0:d.lives)??3,wave:E,gameOver:!1,win:!1}},[]);s.useEffect(()=>{const k=j.current.getContext("2d");i.current=S(1),w(0),L(3),R(1),x(!1);const v=e=>{i.current.keys[e.key]=!0},d=e=>{i.current.keys[e.key]=!1};window.addEventListener("keydown",v),window.addEventListener("keyup",d);let o,f=0;const g=e=>{const a=Math.min(e-f,32);f=e;const t=i.current;t.gameOver||_(t,a),W(k,t),o=requestAnimationFrame(g)};function _(e,a){if((e.keys.ArrowLeft||e.keys.a)&&(e.px=Math.max(0,e.px-4)),(e.keys.ArrowRight||e.keys.d)&&(e.px=Math.min(c-u,e.px+4)),e.keys[" "]&&e.bullets.length<3&&(e.bullets.push({x:e.px+u/2-m/2,y:r-50}),e.keys[" "]=!1),e.bullets=e.bullets.filter(t=>(t.y-=6,t.y>-p)),e.alienBullets=e.alienBullets.filter(t=>(t.y+=3.5,t.y<r)),e.alienTimer+=a,e.alienTimer>16){e.alienTimer=0;let t=!1;for(const l of e.aliens)l.alive&&(l.x+=e.alienDir*e.alienSpeed,(l.x<=5||l.x+y>=c-5)&&(t=!0));if(t){e.alienDir*=-1;for(const l of e.aliens)l.alive&&(l.y+=8)}}if(e.alienShootTimer+=a,e.alienShootTimer>1200-e.wave*80){e.alienShootTimer=0;const t=e.aliens.filter(l=>l.alive);if(t.length){const l=t[Math.floor(Math.random()*t.length)];e.alienBullets.push({x:l.x+y/2,y:l.y+h})}}for(const t of e.bullets)for(const l of e.aliens)l.alive&&t.x<l.x+y&&t.x+m>l.x&&t.y<l.y+h&&t.y+p>l.y&&(l.alive=!1,t.y=-999,e.score+=(4-l.type)*10,w(e.score));for(const t of e.alienBullets)t.x<e.px+u&&t.x+m>e.px&&t.y<r-30&&t.y+p>r-50&&(t.y=9999,e.lives--,L(e.lives),e.lives<=0&&(e.gameOver=!0,x(!0)));for(const t of e.aliens)t.alive&&t.y+h>=r-60&&(e.gameOver=!0,x(!0));if(e.aliens.every(t=>!t.alive)){const t=e.wave+1,l=S(t);l.score=e.score,l.lives=e.lives,i.current=l,R(t)}}function W(e,a){e.fillStyle="#0a0e1a",e.fillRect(0,0,c,r),e.fillStyle="#ffffff15";for(let l=0;l<60;l++){const I=(l*137+50)%c,C=(l*97+30)%r;e.fillRect(I,C,1.5,1.5)}e.fillStyle="#69f0ae",e.fillRect(a.px,r-45,u,M),e.fillStyle="#b9f6ca",e.fillRect(a.px+u/2-3,r-52,6,10),e.fillStyle="#ffd740";for(const l of a.bullets)e.fillRect(l.x,l.y,m,p);e.fillStyle="#ff5252";for(const l of a.alienBullets)e.fillRect(l.x,l.y,m,p);const t=["#ff5252","#ff6e40","#ffd740","#69f0ae"];for(const l of a.aliens)l.alive&&(e.fillStyle=t[l.type],e.fillRect(l.x,l.y,y,h),e.fillStyle="#000",e.fillRect(l.x+7,l.y+6,4,4),e.fillRect(l.x+y-11,l.y+6,4,4))}return o=requestAnimationFrame(g),()=>{cancelAnimationFrame(o),window.removeEventListener("keydown",v),window.removeEventListener("keyup",d)}},[S]);const O=()=>{i.current=S(1),i.current.score=0,i.current.lives=3,w(0),L(3),R(1),x(!1)};return n.jsxs("div",{className:"si-root",children:[n.jsxs("div",{className:"si-hud",children:[n.jsxs("span",{children:["Score: ",A]}),n.jsxs("span",{children:["Wave: ",T]}),n.jsxs("span",{children:["Lives: ","♥".repeat(B)]})]}),n.jsx("canvas",{ref:j,width:c,height:r,className:"si-canvas"}),N&&n.jsxs("div",{className:"si-over",children:[n.jsx("h2",{children:"Game Over"}),n.jsxs("p",{children:["Score: ",A]}),n.jsx("button",{onClick:O,children:"Play Again"})]}),n.jsx("div",{className:"si-controls",children:n.jsx("p",{children:"← → or A/D to move • Space to shoot"})}),n.jsx(D,{})]})}export{U as default};
