import{r as x,j as c}from"./index-CRqe24Pj.js";import{B as Ta}from"./BackButton-DJX8SMkP.js";function Ca(){var Ae;const ke=x.useRef(null),[re,fe]=x.useState("menu"),[xe,X]=x.useState(0),[ve,Z]=x.useState(100),[Oe,Me]=x.useState(100),[Ke,qe]=x.useState(100),[we,ce]=x.useState(1),[Te,ee]=x.useState(0),[Ge,he]=x.useState("Dojo"),[ae,Ye]=x.useState(!1),[pe,te]=x.useState(0),[de,Se]=x.useState(0),[Pe,j]=x.useState(""),[Ce,se]=x.useState(""),je=x.useRef({});return x.useEffect(()=>{const E=ke.current,a=E.getContext("2d");let h,d;function me(){h=E.width=window.innerWidth,d=E.height=window.innerHeight}me(),window.addEventListener("resize",me);let ue,ge=performance.now();const p={gravity:1800,playerSpeed:340,basePunchDmg:12,baseKickDmg:18,upperDmg:25,specialDmg:50,punchRange:55,kickRange:65,upperRange:50,specialRange:120,punchCd:.3,kickCd:.42,upperCd:.55,specialCd:1.2,blockDmgMult:.25,comboTimeout:1.5,specialMeterMax:100,meterPerHit:8,bossWaveInterval:5,powerUpDropChance:.3,powerUpDuration:8,screenShakeIntensity:8,screenShakeDuration:.2,slowMoDuration:.6,slowMoFactor:.25,arenaTransitionDuration:1.5},I=[{name:"Dojo",skyTop:"#1a1a3e",skyBot:"#0a0e1a",ground:"#3b2a17",groundLine:"#5a4030",wallColor:"#2a1c10",pillars:"#4a3020",detail:"#ffd86b",weather:"leaves",bgElements:"lanterns",ambientColor:"rgba(255,216,107,0.03)"},{name:"Street Fight",skyTop:"#0f0f2a",skyBot:"#1a0a2a",ground:"#333340",groundLine:"#555568",wallColor:"#222235",pillars:"#444458",detail:"#e040fb",weather:"rain",bgElements:"neon",ambientColor:"rgba(224,64,251,0.03)"},{name:"Dungeon",skyTop:"#0a0a12",skyBot:"#050508",ground:"#3a3f45",groundLine:"#555a60",wallColor:"#252830",pillars:"#4a4e58",detail:"#69f0ae",weather:"dust",bgElements:"torches",ambientColor:"rgba(105,240,174,0.03)"},{name:"Volcano",skyTop:"#1a0505",skyBot:"#0a0202",ground:"#4a2020",groundLine:"#6a3030",wallColor:"#2a1010",pillars:"#5a2828",detail:"#ff5252",weather:"embers",bgElements:"lava",ambientColor:"rgba(255,82,82,0.04)"},{name:"Ice Temple",skyTop:"#0a0f1a",skyBot:"#05080f",ground:"#5a7a8a",groundLine:"#8aafbf",wallColor:"#3a5a6a",pillars:"#6a9aaa",detail:"#00e5ff",weather:"snow",bgElements:"crystals",ambientColor:"rgba(0,229,255,0.03)"}],De=[{name:"Shadow Ninja",color:"#9c27b0",accentColor:"#e040fb",hpMult:4,spdMult:1.4,dmgMult:1.5,size:1.3,special:"dash"},{name:"Dark Knight",color:"#455a64",accentColor:"#ff5252",hpMult:5,spdMult:1.2,dmgMult:2,size:1.5,special:"slam"},{name:"Fire Demon",color:"#ff3d00",accentColor:"#ffd740",hpMult:6,spdMult:1.6,dmgMult:2.5,size:1.7,special:"fireball"}],Be=[{type:"heal",color:"#69f0ae",icon:"+",effect:"Restores 30 HP"},{type:"damage",color:"#ff5252",icon:"!",effect:"2x damage for 8s"},{type:"speed",color:"#ffd740",icon:">",effect:"1.5x speed for 8s"},{type:"shield",color:"#00e5ff",icon:"O",effect:"Shield blocks 3 hits"}];let S=0,y=1,k=0,be=0,R=!1,z=!1,M=0,J=Number(localStorage.getItem("sfBestScore")||"0");Se(J);let v,A=0,P=0,Ie=0,L=0,He=0,W=0,$=0,F=1,Q=1,D=0,U=0,_=null;const O=[],le=[],K=[],H=[];let u={type:"",timer:0,shieldHits:0};const C=[],l={x:200,y:0,vx:0,vy:0,speed:p.playerSpeed,jumping:!1,hp:100,maxHp:100,attacking:!1,atkType:"",atkTimer:0,atkCd:0,blocking:!1,dir:1,runTime:0,hitFlash:0},o={x:0,y:0,vx:0,vy:0,speed:200,hp:100,maxHp:100,attacking:!1,atkType:"",atkTimer:0,atkCd:0,aiT:0,dir:-1,isBoss:!1,bossType:null,size:1,runTime:0,hitFlash:0,specialCd:0},B={a:!1,d:!1,w:!1,j:!1,k:!1,l:!1,s:!1,q:!1};function ie(t,s,i){return t+(s-t)*Math.min(1,Math.max(0,i))}function N(t,s,i){const f=Ne(t),m=Ne(s),r=Math.round(ie(f.r,m.r,i)),g=Math.round(ie(f.g,m.g,i)),b=Math.round(ie(f.b,m.b,i));return`rgb(${r},${g},${b})`}function Ne(t){return t=t.replace("#",""),{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16)}}function ye(){if(P>0){const t=1-P/p.arenaTransitionDuration,s=I[Ie],i=I[A];return{name:i.name,weather:i.weather,bgElements:i.bgElements,skyTop:N(s.skyTop,i.skyTop,t),skyBot:N(s.skyBot,i.skyBot,t),ground:N(s.ground,i.ground,t),groundLine:N(s.groundLine,i.groundLine,t),wallColor:N(s.wallColor,i.wallColor,t),pillars:N(s.pillars,i.pillars,t),detail:N(s.detail,i.detail,t),ambientColor:i.ambientColor}}return I[A]}function q(t,s,i,f=8,m=6){for(let r=0;r<f;r++)O.push({x:t,y:s,vx:(Math.random()-.5)*m*2,vy:(Math.random()-.5)*m*2-2,life:1,color:i,size:3+Math.random()*4})}function G(t,s,i,f,m=20){K.push({x:t,y:s,text:i,color:f,size:m,life:1.2,vy:-80})}function T(t,s){He=t||p.screenShakeIntensity,L=s||p.screenShakeDuration}function Ee(){W=p.slowMoDuration}function oe(t=.5){$=t}function Ve(t,s){if(Math.random()>p.powerUpDropChance)return;const i=Be[Math.floor(Math.random()*Be.length)];H.push({x:t,y:s-20,type:i.type,color:i.color,icon:i.icon,life:10,bobT:0})}function Je(t){t.type==="heal"?(l.hp=Math.min(l.maxHp,l.hp+30),Z(l.hp),G(l.x,l.y-80,"+30 HP","#69f0ae",22)):t.type==="damage"?(u={type:"damage",timer:p.powerUpDuration,shieldHits:0},j("2x DMG")):t.type==="speed"?(u={type:"speed",timer:p.powerUpDuration,shieldHits:0},j("1.5x SPD")):t.type==="shield"&&(u={type:"shield",timer:999,shieldHits:3},j("SHIELD x3")),q(l.x,l.y-40,t.color,12,8)}function Re(t){return t>=20?"SSS":t>=15?"SS":t>=10?"S":t>=7?"A":t>=5?"B":t>=3?"C":""}function Qe(){return u.type==="damage"?2:1}function _e(){return u.type==="speed"?1.5:1}function ne(){v=d-90,l.x=h*.25,l.y=v,l.vx=0,l.vy=0,l.attacking=!1,l.atkCd=0,l.atkTimer=0,l.blocking=!1,l.hitFlash=0,l.runTime=0,y>1?l.hp=Math.min(l.maxHp,l.hp+20):l.hp=100,Z(l.hp);const t=Math.min(I.length-1,Math.floor((y-1)/4));t!==A&&(Ie=A,A=t,P=p.arenaTransitionDuration,oe(.4)),he(I[A].name);const s=y>1&&y%p.bossWaveInterval===0;if(Ye(s),s){const i=Math.min(De.length-1,Math.floor(y/p.bossWaveInterval)-1),f=De[i];o.isBoss=!0,o.bossType=f,o.size=f.size,o.maxHp=Math.floor((100+(y-1)*20)*f.hpMult),o.hp=o.maxHp,o.speed=(200+y*15)*f.spdMult,o.specialCd=3,D=2,_=f,T(12,.5),oe(.6),Q=.95}else o.isBoss=!1,o.bossType=null,o.size=1,o.maxHp=100+(y-1)*25,o.hp=o.maxHp,o.speed=200+y*15,o.specialCd=0,D=0,Q=1;o.x=h*.75,o.y=v,o.vx=0,o.vy=0,o.attacking=!1,o.atkCd=0,o.atkTimer=0,o.aiT=0,o.dir=-1,o.hitFlash=0,o.runTime=0,Me(o.hp),qe(o.maxHp),C.length=0}function Xe(){le.length=0;for(let t=0;t<60;t++)le.push({x:Math.random()*h,y:Math.random()*d,vx:0,vy:0,size:0,alpha:0})}function Ze(t,s){for(const i of le){switch(s.weather){case"leaves":i.vx=Math.sin(i.y*.01+performance.now()*.001)*30,i.vy=40+Math.sin(i.x*.005)*15,i.size=4+Math.sin(i.x)*2,i.alpha=.4,i.color="#4a7a30";break;case"rain":i.vx=-30,i.vy=500+Math.random()*100,i.size=2,i.alpha=.3,i.color="#88aaff";break;case"dust":i.vx=15+Math.sin(performance.now()*5e-4+i.y)*10,i.vy=10+Math.random()*5,i.size=2+Math.random()*2,i.alpha=.25,i.color="#aaa090";break;case"embers":i.vx=Math.sin(performance.now()*.001+i.x*.1)*20,i.vy=-50-Math.random()*40,i.size=2+Math.random()*3,i.alpha=.6+Math.random()*.3,i.color=Math.random()>.5?"#ff5522":"#ffd740";break;case"snow":i.vx=Math.sin(performance.now()*8e-4+i.y*.02)*25,i.vy=30+Math.random()*20,i.size=2+Math.random()*3,i.alpha=.5,i.color="#ddeeff";break}i.x+=i.vx*t,i.y+=i.vy*t,i.y>d+10&&(i.y=-10,i.x=Math.random()*h),i.y<-10&&(i.y=d+10,i.x=Math.random()*h),i.x>h+10&&(i.x=-10),i.x<-10&&(i.x=h+10)}}function ea(t){const s=a.createLinearGradient(0,0,0,d);s.addColorStop(0,t.skyTop),s.addColorStop(1,t.skyBot),a.fillStyle=s,a.fillRect(0,0,h,d);const i=performance.now()*.001;switch(a.globalAlpha=.15,t.bgElements){case"lanterns":for(let r=0;r<6;r++){const g=h*.1+h*.8*(r/5),b=d*.15+Math.sin(i+r)*10;a.fillStyle="#ffd86b",a.beginPath(),a.arc(g,b,12,0,Math.PI*2),a.fill(),a.fillStyle="#ff8800",a.beginPath(),a.arc(g,b,6,0,Math.PI*2),a.fill()}break;case"neon":a.strokeStyle="#e040fb",a.lineWidth=3;for(let r=0;r<4;r++){const g=h*.15+h*.7*(r/3);a.strokeRect(g-30,d*.08,60,30),a.strokeRect(g-20,d*.12,40,15)}a.strokeStyle="#00e5ff",a.lineWidth=2,a.beginPath(),a.moveTo(0,d*.25),a.lineTo(h,d*.25),a.stroke();break;case"torches":for(let r=0;r<8;r++){const g=h*.05+h*.9*(r/7),b=8+Math.sin(i*5+r*2)*3;a.fillStyle="#ff6600",a.beginPath(),a.arc(g,d*.35,b,0,Math.PI*2),a.fill(),a.fillStyle="#ffaa00",a.beginPath(),a.arc(g,d*.35,b*.5,0,Math.PI*2),a.fill()}break;case"lava":a.fillStyle="#ff2200";for(let r=0;r<5;r++){const g=(i*30+r*h*.22)%(h+60)-30,b=d*.8+Math.sin(i*2+r)*8;a.beginPath(),a.arc(g,b,15+Math.sin(i*3+r)*5,0,Math.PI*2),a.fill()}break;case"crystals":a.fillStyle="#00e5ff";for(let r=0;r<6;r++){const g=h*.08+h*.84*(r/5),b=20+r%3*10;a.beginPath(),a.moveTo(g,d*.2),a.lineTo(g-6,d*.2+b),a.lineTo(g+6,d*.2+b),a.closePath(),a.fill()}break}a.globalAlpha=1,a.fillStyle=t.pillars;const f=18,m=d*.45;for(let r=0;r<4;r++){const g=h*.08+h*.84*(r/3);a.fillRect(g-f/2,v-m,f,m+20),a.fillStyle=t.detail,a.globalAlpha=.3,a.fillRect(g-f/2-4,v-m-6,f+8,8),a.globalAlpha=1,a.fillStyle=t.pillars}a.fillStyle=t.wallColor,a.fillRect(0,v-5,h,8),a.fillStyle=t.ground,a.fillRect(0,v+3,h,d-v),a.fillStyle=t.groundLine,a.fillRect(0,v+3,h,4),a.fillStyle=t.ambientColor,a.fillRect(0,0,h,d)}function aa(){for(const t of le)a.globalAlpha=t.alpha,a.fillStyle=t.color,ye().weather==="rain"?a.fillRect(t.x,t.y,1,t.size*3):(a.beginPath(),a.arc(t.x,t.y,t.size,0,Math.PI*2),a.fill());a.globalAlpha=1}function ze(t,s,i,f,m,r,g=1,b=!1,V=null){const n=g,Ma=b&&V||i;a.strokeStyle=Ma,a.lineWidth=3*n,a.lineCap="round",b&&(a.save(),a.shadowColor=V||"#ff0000",a.shadowBlur=15*n),a.beginPath(),a.arc(t,s-60*n,13*n,0,Math.PI*2),a.stroke(),b&&(a.fillStyle="#ff0000",a.beginPath(),a.arc(t-4*n*f,s-62*n,2*n,0,Math.PI*2),a.fill(),a.beginPath(),a.arc(t+4*n*f,s-62*n,2*n,0,Math.PI*2),a.fill(),a.beginPath(),a.moveTo(t-10*n,s-70*n),a.lineTo(t-16*n,s-85*n),a.stroke(),a.moveTo(t+10*n,s-70*n),a.lineTo(t+16*n,s-85*n),a.stroke()),a.beginPath(),a.moveTo(t,s-48*n),a.lineTo(t,s-20*n),a.stroke();const Fe=Math.sin(performance.now()*.008+t);if(m&&r==="punch")a.beginPath(),a.moveTo(t,s-40*n),a.lineTo(t+f*35*n,s-36*n),a.stroke(),a.beginPath(),a.moveTo(t,s-40*n),a.lineTo(t-f*12*n,s-30*n),a.stroke(),a.fillStyle=b&&V||"#ffd740",a.beginPath(),a.arc(t+f*38*n,s-36*n,7*n,0,Math.PI*2),a.fill();else if(m&&r==="kick")a.beginPath(),a.moveTo(t,s-40*n),a.lineTo(t-12*n,s-32*n),a.stroke(),a.beginPath(),a.moveTo(t,s-40*n),a.lineTo(t+12*n,s-32*n),a.stroke();else if(m&&r==="upper")a.beginPath(),a.moveTo(t,s-40*n),a.lineTo(t+f*20*n,s-65*n),a.stroke(),a.beginPath(),a.moveTo(t,s-40*n),a.lineTo(t-f*10*n,s-30*n),a.stroke(),a.fillStyle="#e040fb",a.beginPath(),a.arc(t+f*22*n,s-68*n,8*n,0,Math.PI*2),a.fill();else if(m&&r==="special"){a.beginPath(),a.moveTo(t,s-40*n),a.lineTo(t+f*42*n,s-38*n),a.stroke(),a.beginPath(),a.moveTo(t,s-40*n),a.lineTo(t+f*40*n,s-30*n),a.stroke(),a.save(),a.shadowColor="#ffd740",a.shadowBlur=20,a.fillStyle="#ffd740";for(let w=0;w<3;w++){const wa=10+w*7;a.globalAlpha=.6-w*.15,a.beginPath(),a.arc(t+f*(45+w*10)*n,s-34*n,wa*n,0,Math.PI*2),a.fill()}a.globalAlpha=1,a.restore()}else{const w=Math.abs(l.vx)>10||b&&Math.abs(o.vx)>10?Fe*15:0;a.beginPath(),a.moveTo(t,s-40*n),a.lineTo(t-12*n+w*n*f,s-28*n),a.stroke(),a.beginPath(),a.moveTo(t,s-40*n),a.lineTo(t+12*n-w*n*f,s-28*n),a.stroke()}if(m&&r==="kick")a.beginPath(),a.moveTo(t,s-20*n),a.lineTo(t+f*40*n,s-12*n),a.stroke(),a.fillStyle=b&&V||"#ff5252",a.beginPath(),a.arc(t+f*43*n,s-12*n,7*n,0,Math.PI*2),a.fill(),a.beginPath(),a.moveTo(t,s-20*n),a.lineTo(t-f*8*n,s),a.stroke();else{const w=Math.abs(l.vx)>10||b&&Math.abs(o.vx)>10?Fe*12:0;a.beginPath(),a.moveTo(t,s-20*n),a.lineTo(t-12*n+w*n,s),a.stroke(),a.beginPath(),a.moveTo(t,s-20*n),a.lineTo(t+12*n-w*n,s),a.stroke()}b&&a.restore();const Ue=b?o.hitFlash:l.hitFlash;Ue>0&&(a.globalAlpha=Ue,a.fillStyle="#fff",a.beginPath(),a.arc(t,s-35*n,30*n,0,Math.PI*2),a.fill(),a.globalAlpha=1),!b&&l.blocking&&(a.strokeStyle="#00e5ff",a.lineWidth=2,a.globalAlpha=.6,a.beginPath(),a.arc(t,s-35,35,0,Math.PI*2),a.stroke(),a.globalAlpha=1),!b&&u.type==="shield"&&u.shieldHits>0&&(a.strokeStyle="#00e5ff",a.lineWidth=3,a.globalAlpha=.4+Math.sin(performance.now()*.005)*.2,a.beginPath(),a.arc(t,s-35,42,0,Math.PI*2),a.stroke(),a.globalAlpha=1),!b&&u.type==="damage"&&u.timer>0&&(a.save(),a.shadowColor="#ff5252",a.shadowBlur=15,a.strokeStyle="#ff5252",a.globalAlpha=.3,a.lineWidth=2,a.beginPath(),a.arc(t,s-35,38,0,Math.PI*2),a.stroke(),a.restore(),a.globalAlpha=1)}function ta(){for(const t of H){const s=t.y+Math.sin(t.bobT*3)*5;a.save(),a.shadowColor=t.color,a.shadowBlur=12,a.fillStyle=t.color,a.globalAlpha=.8,a.beginPath(),a.arc(t.x,s,14,0,Math.PI*2),a.fill(),a.globalAlpha=1,a.fillStyle="#000",a.font="bold 16px sans-serif",a.textAlign="center",a.textBaseline="middle",a.fillText(t.icon,t.x,s+1),a.restore()}}function sa(){for(const t of C)a.save(),a.shadowColor=t.color,a.shadowBlur=10,a.fillStyle=t.color,a.globalAlpha=.9,a.beginPath(),a.arc(t.x,t.y,t.r,0,Math.PI*2),a.fill(),a.globalAlpha=.5,a.beginPath(),a.arc(t.x,t.y,t.r*1.6,0,Math.PI*2),a.fill(),a.restore(),a.globalAlpha=1}function la(){for(const t of O)a.fillStyle=t.color,a.globalAlpha=t.life,a.beginPath(),a.arc(t.x,t.y,t.size*t.life,0,Math.PI*2),a.fill();a.globalAlpha=1}function ia(){for(const t of K)a.save(),a.font=`bold ${t.size}px sans-serif`,a.textAlign="center",a.fillStyle=t.color,a.globalAlpha=Math.min(1,t.life),a.fillText(t.text,t.x,t.y),a.restore()}function oa(){if(D<=0||!_)return;const t=D;a.save(),a.fillStyle=`rgba(0,0,0,${Math.min(.6,t*.4)})`,a.fillRect(0,0,h,d),a.font=`bold ${48+Math.sin(t*8)*4}px sans-serif`,a.textAlign="center",a.fillStyle=_.accentColor,a.shadowColor=_.accentColor,a.shadowBlur=25,a.fillText(`âš” ${_.name} âš”`,h/2,d/2-20),a.font="bold 22px sans-serif",a.fillStyle="#eee",a.shadowBlur=0,a.fillText(`BOSS WAVE ${y}`,h/2,d/2+25),a.restore()}function na(){if(U<=0)return;const t=U;a.save(),a.fillStyle=`rgba(255,215,0,${Math.min(.3,t*.2)})`,a.fillRect(0,0,h,d),a.font=`bold ${52+Math.sin(t*10)*3}px sans-serif`,a.textAlign="center",a.fillStyle="#ffd740",a.shadowColor="#ffd740",a.shadowBlur=30,a.fillText("BOSS DEFEATED!",h/2,d/2-15),a.font="bold 20px sans-serif",a.fillStyle="#69f0ae",a.shadowBlur=0,a.fillText(`+${500*Math.ceil(y/p.bossWaveInterval)} BONUS`,h/2,d/2+25),a.restore()}function ra(t){v=d-90;const s=_e();l.blocking?l.vx=0:B.a?(l.vx=-340*s,l.dir=-1):B.d?(l.vx=l.speed*s,l.dir=1):l.vx=0,B.w&&!l.jumping&&(l.vy=-620,l.jumping=!0),l.vy+=p.gravity*t,l.x+=l.vx*t,l.y+=l.vy*t,l.y>=v&&(l.y=v,l.vy=0,l.jumping=!1),l.x=Math.max(60,Math.min(h-60,l.x)),l.atkCd>0&&(l.atkCd-=t),l.atkTimer>0&&(l.atkTimer-=t,l.atkTimer<=0&&(l.attacking=!1)),l.hitFlash>0&&(l.hitFlash-=t*4),l.blocking=B.l&&!l.attacking}function fa(t,s,i,f){const m=Math.floor(t*Qe());o.hp-=m,o.hitFlash=.5,S+=m*(1+k*.2),k++,be=p.comboTimeout,M=Math.min(p.specialMeterMax,M+p.meterPerHit),ee(k),X(Math.floor(S)),Me(Math.max(0,o.hp)),te(Math.floor(M/p.specialMeterMax*100)),se(Re(k));const r={punch:"#ffd740",kick:"#ff5252",upper:"#e040fb",special:"#ffd740"};q(i,f,r[s]||"#fff",10+k,8),G(i,f-20,`-${m}`,r[s]||"#fff",18+Math.min(k*2,16)),k>=3&&T(3+k,.1),k>=10&&T(10,.2),s==="special"&&(T(15,.35),Ee(),oe(.5)),s==="upper"&&(o.vy=-400,T(8,.15))}function ca(t){if(!l.attacking||l.atkTimer<Y(l.atkType)-.05)return;const s={punch:p.punchRange,kick:p.kickRange,upper:p.upperRange,special:p.specialRange}[l.atkType]||40,i=Math.abs(l.x-o.x),f=Math.abs(l.y-o.y);if(i<s*o.size&&f<60*o.size){const m={punch:p.basePunchDmg,kick:p.baseKickDmg,upper:p.upperDmg,special:p.specialDmg}[l.atkType]||10;fa(m+k*2,l.atkType,o.x,o.y-30*o.size)}}function Y(t){return{punch:.18,kick:.22,upper:.28,special:.45}[t]||.2}function ha(t){var f,m,r,g;if(D>0)return;o.aiT+=t;const s=l.x-o.x,i=Math.abs(s);if(o.aiT>.5){const b=o.isBoss?80*o.size:60;if(i>b)o.vx=s>0?o.speed:-o.speed,o.dir=s>0?1:-1,o.runTime+=t;else{o.vx*=.8,o.dir=s>0?1:-1;const V=(.8+y*.12)*t;if(Math.random()<V&&!o.attacking&&o.atkCd<=0&&(o.attacking=!0,o.atkType=Math.random()<.4?"kick":"punch",o.atkTimer=Y(o.atkType),o.atkCd=(o.isBoss?.4:.55)-Math.min(.2,y*.015),i<(o.atkType==="kick"?60:45)*o.size&&Math.abs(l.y-o.y)<55)){let n=(o.atkType==="kick"?15:10)+y*.8;o.isBoss&&o.bossType&&(n*=o.bossType.dmgMult),l.blocking?(n*=p.blockDmgMult,G(l.x,l.y-70,"BLOCKED!","#00e5ff",18)):u.type==="shield"&&u.shieldHits>0&&(u.shieldHits--,n=0,G(l.x,l.y-70,"SHIELD!","#00e5ff",20),u.shieldHits<=0&&(u={type:"",timer:0,shieldHits:0},j(""))),l.hp-=Math.floor(n),l.hitFlash=.4,Z(Math.max(0,l.hp)),q(l.x,l.y-30,o.isBoss&&((f=o.bossType)==null?void 0:f.accentColor)||"#ff5252",6),l.blocking||T(5,.12)}o.isBoss&&o.specialCd<=0&&!o.attacking&&(o.specialCd=3+Math.random()*2,((m=o.bossType)==null?void 0:m.special)==="fireball"?(C.push({x:o.x,y:o.y-35*o.size,vx:(s>0?1:-1)*400,vy:-50,r:10,color:"#ff4400",dmg:20,life:3}),C.push({x:o.x,y:o.y-50*o.size,vx:(s>0?1:-1)*350,vy:-120,r:8,color:"#ffd740",dmg:15,life:3})):((r=o.bossType)==null?void 0:r.special)==="dash"?(o.vx=(s>0?1:-1)*o.speed*4,T(6,.15),q(o.x,o.y-30,"#9c27b0",10,10)):((g=o.bossType)==null?void 0:g.special)==="slam"&&(o.vy=-500,setTimeout(()=>{T(15,.3),q(o.x,o.y,"#ff5252",20,12)},500))),o.specialCd>0&&(o.specialCd-=t)}}o.vy+=p.gravity*t,o.x+=o.vx*t,o.y+=o.vy*t,o.y>=v&&(o.y=v,o.vy=0),o.x=Math.max(60,Math.min(h-60,o.x)),o.atkCd>0&&(o.atkCd-=t),o.atkTimer>0&&(o.atkTimer-=t,o.atkTimer<=0&&(o.attacking=!1)),o.hitFlash>0&&(o.hitFlash-=t*4)}function pa(t){for(let s=C.length-1;s>=0;s--){const i=C[s];i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=p.gravity*.3*t,i.life-=t;const f=l.x-i.x,m=l.y-30-i.y;if(Math.sqrt(f*f+m*m)<i.r+25){let r=i.dmg;l.blocking?(r*=p.blockDmgMult,G(l.x,l.y-70,"BLOCKED!","#00e5ff")):u.type==="shield"&&u.shieldHits>0&&(u.shieldHits--,r=0,G(l.x,l.y-70,"SHIELD!","#00e5ff",20),u.shieldHits<=0&&(u={type:"",timer:0,shieldHits:0},j(""))),l.hp-=Math.floor(r),l.hitFlash=.4,Z(Math.max(0,l.hp)),q(i.x,i.y,i.color,8),T(6,.15),C.splice(s,1);continue}(i.life<=0||i.y>d||i.x<-50||i.x>h+50)&&C.splice(s,1)}}function da(t){for(let s=O.length-1;s>=0;s--){const i=O[s];i.x+=i.vx,i.y+=i.vy,i.vy+=80*t,i.life-=t*1.8,i.life<=0&&O.splice(s,1)}for(let s=K.length-1;s>=0;s--){const i=K[s];i.y+=i.vy*t,i.life-=t,i.life<=0&&K.splice(s,1)}}function ma(t){u.type&&u.type!=="shield"&&u.type!=="heal"&&(u.timer-=t,u.timer<=0&&(u={type:"",timer:0,shieldHits:0},j("")));for(let s=H.length-1;s>=0;s--){const i=H[s];if(i.bobT+=t,i.life-=t,i.life<=0){H.splice(s,1);continue}Math.abs(l.x-i.x)<35&&Math.abs(l.y-i.y)<50&&(Je(i),H.splice(s,1))}}function ua(t){L>0&&(L-=t),W>0&&(W-=t),$>0&&($-=t*3),F=ie(F,Q,t*3)}function ga(t){be>0?be-=t:k>0&&(k=0,ee(0),se(""))}function ba(t){P>0&&(P-=t,P<0&&(P=0))}function ya(t){D>0&&(D-=t),U>0&&(U-=t)}function ka(){if(o.hp<=0){if(o.isBoss){const s=500*Math.ceil(y/p.bossWaveInterval);S+=s,U=2,T(18,.5),Ee(),oe(.7),Q=1}else S+=100*y;Ve(o.x,o.y),X(Math.floor(S)),y++,ce(y),ne();return}l.hp<=0&&(z=!0,R=!1,S>J&&(J=Math.floor(S),localStorage.setItem("sfBestScore",String(J)),Se(J)),fe("over"))}function xa(t){const s=W>0?t*p.slowMoFactor:t;ya(s),ba(s),ra(s),ca(),ha(s),pa(s),ma(s),ga(s),da(s),ua(t),Ze(s,ye()),ka()}function va(){var f,m;a.save();let t=0,s=0;if(L>0){const r=He*(L/p.screenShakeDuration);t=(Math.random()-.5)*r*2,s=(Math.random()-.5)*r*2}F!==1&&(a.translate(h/2,d/2),a.scale(F,F),a.translate(-h/2,-d/2)),a.translate(t,s);const i=ye();if(ea(i),aa(),ta(),sa(),ze(o.x,o.y,o.isBoss&&((f=o.bossType)==null?void 0:f.color)||"#ff5252",o.dir,o.attacking,o.atkType,o.size,o.isBoss,(m=o.bossType)==null?void 0:m.accentColor),ze(l.x,l.y,"#00e5ff",l.dir,l.attacking,l.atkType),la(),ia(),k>2){a.save();const r=28+Math.min(k*2,24);a.font=`bold ${r}px sans-serif`,a.fillStyle="#ffd740",a.textAlign="center",a.globalAlpha=.9,a.shadowColor="#ff8800",a.shadowBlur=15,a.fillText(`${k}x COMBO!`,h/2,d*.38);const g=Re(k);g&&(a.font=`bold ${r+8}px sans-serif`,a.fillStyle=k>=15?"#ff5252":k>=10?"#e040fb":"#ffd740",a.fillText(g,h/2,d*.38-r-5)),a.restore()}if(M>0&&M<p.specialMeterMax?(a.fillStyle="rgba(0,0,0,0.4)",a.fillRect(l.x-120/2,l.y+10,120,6),a.fillStyle="#ffd740",a.fillRect(l.x-120/2,l.y+10,120*(M/p.specialMeterMax),6)):M>=p.specialMeterMax&&(a.save(),a.font="bold 12px sans-serif",a.fillStyle="#ffd740",a.textAlign="center",a.globalAlpha=.5+Math.sin(performance.now()*.006)*.3,a.fillText("Q - SPECIAL!",l.x,l.y+20),a.restore()),a.restore(),$>0&&(a.fillStyle=`rgba(255,255,255,${Math.min($,1)})`,a.fillRect(0,0,h,d)),W>0){const r=a.createRadialGradient(h/2,d/2,h*.3,h/2,d/2,h*.7);r.addColorStop(0,"rgba(0,0,0,0)"),r.addColorStop(1,"rgba(0,0,0,0.4)"),a.fillStyle=r,a.fillRect(0,0,h,d)}oa(),na()}function Le(t){const s=Math.min((t-ge)/1e3,.05);ge=t,R&&!z&&xa(s),va(),ue=requestAnimationFrame(Le)}const We=t=>{const s=t.key.toLowerCase();t.code==="Space"&&!R&&!z&&(R=!0,z=!1,S=0,y=1,k=0,M=0,A=0,P=0,u={type:"",timer:0,shieldHits:0},X(0),ce(1),ee(0),te(0),se(""),j(""),he(I[0].name),ne(),fe("playing")),s in B&&(B[s]=!0),!(!R||z||l.blocking)&&(s==="j"&&!l.attacking&&l.atkCd<=0&&(l.attacking=!0,l.atkType="punch",l.atkTimer=Y("punch"),l.atkCd=p.punchCd),s==="k"&&!l.attacking&&l.atkCd<=0&&(l.attacking=!0,l.atkType="kick",l.atkTimer=Y("kick"),l.atkCd=p.kickCd),s==="s"&&!l.attacking&&l.atkCd<=0&&!l.jumping&&(l.attacking=!0,l.atkType="upper",l.atkTimer=Y("upper"),l.atkCd=p.upperCd,l.vy=-350,l.jumping=!0),s==="q"&&!l.attacking&&M>=p.specialMeterMax&&(l.attacking=!0,l.atkType="special",l.atkTimer=Y("special"),l.atkCd=p.specialCd,M=0,te(0)))},$e=t=>{const s=t.key.toLowerCase();s in B&&(B[s]=!1)};return je.current.restart=()=>{z=!1,R=!1,S=0,y=1,k=0,M=0,O.length=0,K.length=0,H.length=0,C.length=0,u={type:"",timer:0,shieldHits:0},A=0,P=0,L=0,W=0,$=0,F=1,Q=1,D=0,U=0,X(0),ce(1),ee(0),te(0),se(""),j(""),he(I[0].name),l.hp=100,l.maxHp=100,ne(),fe("menu")},window.addEventListener("keydown",We),window.addEventListener("keyup",$e),Xe(),ne(),ge=performance.now(),ue=requestAnimationFrame(Le),()=>{cancelAnimationFrame(ue),window.removeEventListener("keydown",We),window.removeEventListener("keyup",$e),window.removeEventListener("resize",me)}},[]),c.jsxs("div",{className:"sf-root",children:[c.jsx("canvas",{ref:ke,className:"sf-canvas"}),re==="menu"&&c.jsxs("div",{className:"sf-overlay",children:[c.jsx("h1",{children:"ðŸ¥Š Stickman Fighter"}),c.jsx("p",{className:"sf-subtitle",children:"Epic Combat with Bosses, Arenas & Special Moves"}),c.jsxs("div",{className:"sf-keys",children:[c.jsxs("p",{children:[c.jsx("b",{children:"A / D"})," â€“ Move Â  ",c.jsx("b",{children:"W"})," â€“ Jump Â  ",c.jsx("b",{children:"L"})," â€“ Block"]}),c.jsxs("p",{children:[c.jsx("b",{children:"J"})," â€“ Punch Â  ",c.jsx("b",{children:"K"})," â€“ Kick Â  ",c.jsx("b",{children:"S"})," â€“ Uppercut"]}),c.jsxs("p",{children:[c.jsx("b",{children:"Q"})," â€“ Special Attack (when meter full)"]})]}),c.jsx("p",{className:"sf-start-hint",children:"Press SPACE to fight"}),de>0&&c.jsxs("p",{className:"sf-best-display",children:["Best: ",de]})]}),re==="playing"&&c.jsxs("div",{className:"sf-hud",children:[c.jsxs("div",{className:"sf-hud-left",children:[c.jsxs("div",{className:"sf-bar-wrap",children:[c.jsx("span",{className:"sf-label cyan-text",children:"YOU"}),c.jsx("div",{className:"sf-bar",children:c.jsx("div",{className:"sf-fill cyan",style:{width:`${ve}%`}})})]}),pe>0&&c.jsxs("div",{className:"sf-meter-wrap",children:[c.jsx("span",{className:"sf-label gold-text",children:"SP"}),c.jsx("div",{className:"sf-meter-bar",children:c.jsx("div",{className:"sf-meter-fill",style:{width:`${pe}%`}})}),pe>=100&&c.jsx("span",{className:"sf-ready-flash",children:"READY!"})]})]}),c.jsxs("div",{className:"sf-info",children:[c.jsxs("div",{className:"sf-score-display",children:["Score: ",xe]}),c.jsxs("div",{className:"sf-wave-display",children:["Wave ",we," ",ae&&c.jsx("span",{className:"sf-boss-tag",children:"BOSS"})]}),c.jsx("div",{className:"sf-arena-name",children:Ge}),Te>1&&c.jsxs("div",{className:"sf-combo-hud",children:[Te,"x"," ",Ce&&c.jsx("span",{className:"sf-rank",children:Ce})]}),Pe&&c.jsx("div",{className:"sf-powerup-hud",children:Pe})]}),c.jsxs("div",{className:"sf-hud-right",children:[c.jsx("span",{className:"sf-label red-text",children:ae?((Ae=e.bossType)==null?void 0:Ae.name)||"BOSS":"ENEMY"}),c.jsx("div",{className:"sf-bar-wrap",children:c.jsx("div",{className:`sf-bar ${ae?"boss-bar":""}`,children:c.jsx("div",{className:`sf-fill ${ae?"boss":"red"}`,style:{width:`${Math.max(0,Oe/Ke*100)}%`}})})})]})]}),re==="over"&&c.jsxs("div",{className:"sf-gameover",children:[c.jsx("h2",{children:ve<=0?"Defeated!":"Victory!"}),c.jsxs("p",{className:"sf-go-score",children:["Score: ",xe]}),c.jsxs("p",{children:["Waves Survived: ",we-1]}),c.jsxs("p",{className:"sf-go-best",children:["Best: ",de]}),c.jsx("button",{onClick:()=>{var E,a;return(a=(E=je.current).restart)==null?void 0:a.call(E)},children:"Fight Again"})]}),c.jsx(Ta,{})]})}export{Ca as default};
