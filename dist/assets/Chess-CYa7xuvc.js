import{r as N,j as c}from"./index-DxoVmnoF.js";import{B as Cs}from"./BackButton-rhTEpRQT.js";const w=0,C=1,M=2,T=3,y=4,q=5,D=6,I=7,H=8,K=9,E=10,G=11,$=12,z={[C]:"♙",[M]:"♘",[T]:"♗",[y]:"♖",[q]:"♕",[D]:"♔",[I]:"♟",[H]:"♞",[K]:"♝",[E]:"♜",[G]:"♛",[$]:"♚"},g=s=>s>=C&&s<=D,ls=s=>s>=I&&s<=$,bs=s=>s===w?null:g(s)?"w":"b",ys=[0,0,0,0,0,0,0,0,50,50,50,50,50,50,50,50,10,10,20,30,30,20,10,10,5,5,10,25,25,10,5,5,0,0,0,20,20,0,0,0,5,-5,-10,0,0,-10,-5,5,5,10,10,-20,-20,10,10,5,0,0,0,0,0,0,0,0],Ps=[-50,-40,-30,-30,-30,-30,-40,-50,-40,-20,0,0,0,0,-20,-40,-30,0,10,15,15,10,0,-30,-30,5,15,20,20,15,5,-30,-30,0,15,20,20,15,0,-30,-30,5,10,15,15,10,5,-30,-40,-20,0,5,5,0,-20,-40,-50,-40,-30,-30,-30,-30,-40,-50],vs=[-20,-10,-10,-10,-10,-10,-10,-20,-10,0,0,0,0,0,0,-10,-10,0,5,10,10,5,0,-10,-10,5,5,10,10,5,5,-10,-10,0,10,10,10,10,0,-10,-10,10,10,10,10,10,10,-10,-10,5,0,0,0,0,5,-10,-20,-10,-10,-10,-10,-10,-10,-20],Bs=[0,0,0,0,0,0,0,0,5,10,10,10,10,10,10,5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,0,0,0,5,5,0,0,0],Is=[-20,-10,-10,-5,-5,-10,-10,-20,-10,0,0,0,0,0,0,-10,-10,0,5,5,5,5,0,-10,-5,0,5,5,5,5,0,-5,0,0,5,5,5,5,0,-5,-10,5,5,5,5,5,0,-10,-10,0,5,0,0,0,0,-10,-20,-10,-10,-5,-5,-10,-10,-20],qs=[-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-20,-30,-30,-40,-40,-30,-30,-20,-10,-20,-20,-20,-20,-20,-20,-10,20,20,0,0,0,0,20,20,20,30,10,0,0,10,30,20];function Ts(s,o){const f=g(s)?s:s-6,e=g(s)?o:(7-Math.floor(o/8))*8+o%8;switch(f){case C:return ys[e];case M:return Ps[e];case T:return vs[e];case y:return Bs[e];case q:return Is[e];case D:return qs[e];default:return 0}}const is={[C]:100,[M]:320,[T]:330,[y]:500,[q]:900,[D]:2e4,[I]:100,[H]:320,[K]:330,[E]:500,[G]:900,[$]:2e4};function ds(){return[E,H,K,G,$,K,H,E,I,I,I,I,I,I,I,I,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,C,C,C,C,C,C,C,C,y,M,T,q,D,T,M,y]}function ks(){return{wk:!0,wq:!0,bk:!0,bq:!0}}const Z=s=>[Math.floor(s/8),s%8],b=(s,o)=>s*8+o,A=(s,o)=>s>=0&&s<8&&o>=0&&o<8;function Es(s,o,f,e){const t=[],h=o==="w"?g:ls,k=o==="w"?ls:g;for(let m=0;m<64;m++){const d=s[m];if(!h(d))continue;const[p,n]=Z(m),r=g(d)?d:d-6;if(r===C){const l=o==="w"?-1:1,j=o==="w"?6:1,i=o==="w"?0:7,a=p+l;if(A(a,n)&&s[b(a,n)]===w)if(a===i)for(const B of o==="w"?[q,y,T,M]:[G,E,K,H])t.push({from:m,to:b(a,n),promo:B});else t.push({from:m,to:b(a,n)}),p===j&&s[b(p+2*l,n)]===w&&t.push({from:m,to:b(p+2*l,n),double:!0});for(const B of[-1,1]){if(!A(a,n+B))continue;const P=b(a,n+B);if(k(s[P])||P===e)if(a===i)for(const es of o==="w"?[q,y,T,M]:[G,E,K,H])t.push({from:m,to:P,promo:es,ep:P===e});else t.push({from:m,to:P,ep:P===e})}}else if(r===M)for(const[l,j]of[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]]){const i=p+l,a=n+j;A(i,a)&&!h(s[b(i,a)])&&t.push({from:m,to:b(i,a)})}else if(r===T||r===y||r===q){const l=[];(r===T||r===q)&&l.push([-1,-1],[-1,1],[1,-1],[1,1]),(r===y||r===q)&&l.push([-1,0],[1,0],[0,-1],[0,1]);for(const[j,i]of l){let a=p+j,B=n+i;for(;A(a,B);){const P=b(a,B);if(h(s[P])||(t.push({from:m,to:P}),k(s[P])))break;a+=j,B+=i}}}else if(r===D){for(const[l,j]of[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]]){const i=p+l,a=n+j;A(i,a)&&!h(s[b(i,a)])&&t.push({from:m,to:b(i,a)})}o==="w"?(f.wk&&s[61]===w&&s[62]===w&&s[63]===y&&t.push({from:m,to:62,castle:"wk"}),f.wq&&s[59]===w&&s[58]===w&&s[57]===w&&s[56]===y&&t.push({from:m,to:58,castle:"wq"})):(f.bk&&s[5]===w&&s[6]===w&&s[7]===E&&t.push({from:m,to:6,castle:"bk"}),f.bq&&s[3]===w&&s[2]===w&&s[1]===w&&s[0]===E&&t.push({from:m,to:2,castle:"bq"}))}}return t}function J(s,o,f){const e=f==="w"?g:ls,[t,h]=Z(o);for(const[d,p]of[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]]){const n=t+d,r=h+p;if(A(n,r)){const l=s[b(n,r)];if(e(l)&&(g(l)?l:l-6)===M)return!0}}const k=f==="w"?1:-1;for(const d of[-1,1]){const p=t+k,n=h+d;if(A(p,n)){const r=s[b(p,n)];if(e(r)&&(g(r)?r:r-6)===C)return!0}}for(const[d,p]of[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]]){const n=t+d,r=h+p;if(A(n,r)){const l=s[b(n,r)];if(e(l)&&(g(l)?l:l-6)===D)return!0}}const m=[[-1,-1],[-1,1],[1,-1],[1,1],[-1,0],[1,0],[0,-1],[0,1]];for(let d=0;d<8;d++){const[p,n]=m[d];let r=t+p,l=h+n;for(;A(r,l);){const j=s[b(r,l)];if(j!==w){if(e(j)){const i=g(j)?j:j-6,a=d<4;if(i===q||a&&i===T||!a&&i===y)return!0}break}r+=p,l+=n}}return!1}function as(s,o){const f=o==="w"?D:$;return s.indexOf(f)}function ss(s,o,f,e){const t=[...s],h={...o};let k=-1;const m=t[e.from];if(t[e.to]=e.promo||m,t[e.from]=w,e.ep){const d=bs(m)==="w"?1:-1;t[e.to+d*8]=w}return e.double&&(k=(e.from+e.to)/2),e.castle==="wk"&&(t[61]=y,t[63]=w),e.castle==="wq"&&(t[59]=y,t[56]=w),e.castle==="bk"&&(t[5]=E,t[7]=w),e.castle==="bq"&&(t[3]=E,t[0]=w),(e.from===60||e.to===60)&&(h.wk=!1,h.wq=!1),(e.from===4||e.to===4)&&(h.bk=!1,h.bq=!1),(e.from===63||e.to===63)&&(h.wk=!1),(e.from===56||e.to===56)&&(h.wq=!1),(e.from===7||e.to===7)&&(h.bk=!1),(e.from===0||e.to===0)&&(h.bq=!1),{board:t,castle:h,enPassant:k}}function X(s,o,f,e){const t=Es(s,o,f,e),h=[],k=o==="w"?"b":"w";for(const m of t){if(m.castle){const n=as(s,o);if(J(s,n,k)||(m.castle.endsWith("k")?[n+1,n+2]:[n-1,n-2]).some(l=>J(s,l,k)))continue}const{board:d}=ss(s,f,e,m),p=as(d,o);p===-1||J(d,p,k)||h.push(m)}return h}function fs(s,o){const f=as(s,o);return f!==-1&&J(s,f,o==="w"?"b":"w")}function Ms(s){let o=0;for(let f=0;f<64;f++){const e=s[f];if(e===w)continue;const t=is[e]+Ts(e,f);o+=g(e)?t:-t}return o}function us(s,o,f,e,t,h,k,m){if(e===0)return{score:Ms(s),move:null};const d=X(s,m,o,f);if(d.length===0)return fs(s,m)?{score:k?-99999:99999,move:null}:{score:0,move:null};d.sort((n,r)=>{const l=s[n.to]!==w&&is[s[n.to]]||0;return(s[r.to]!==w&&is[s[r.to]]||0)-l});let p=null;if(k){let n=-1/0;for(const r of d){const{board:l,castle:j,enPassant:i}=ss(s,o,f,r),{score:a}=us(l,j,i,e-1,t,h,!1,"b");if(a>n&&(n=a,p=r),t=Math.max(t,a),h<=t)break}return{score:n,move:p}}else{let n=1/0;for(const r of d){const{board:l,castle:j,enPassant:i}=ss(s,o,f,r),{score:a}=us(l,j,i,e-1,t,h,!0,"w");if(a<n&&(n=a,p=r),h=Math.min(h,a),h<=t)break}return{score:n,move:p}}}const ws=[{label:"Beginner",depth:1},{label:"Easy",depth:2},{label:"Medium",depth:3},{label:"Hard",depth:4}];function Ds(){const[s,o]=N.useState(ds),[f,e]=N.useState(ks),[t,h]=N.useState(-1),[k,m]=N.useState("w"),[d,p]=N.useState(null),[n,r]=N.useState([]),[l,j]=N.useState(1),[i,a]=N.useState("playing"),[B,P]=N.useState(!1),[es,ts]=N.useState([]),[xs,ns]=N.useState([]),[Q,hs]=N.useState(null),[js,ms]=N.useState([]),[F,cs]=N.useState(null),U=N.useRef(!1),os=N.useCallback(()=>{o(ds()),e(ks()),h(-1),m("w"),p(null),r([]),a("playing"),P(!1),ts([]),ns([]),hs(null),ms([]),cs(null),U.current=!1},[]),V=N.useCallback((u,x,v,S)=>{const L=u[S.to],{board:R,castle:O,enPassant:Y}=ss(u,x,v,S),_=k==="w"?"b":"w";if(L!==w&&(g(L)?ts(W=>[...W,L]):ns(W=>[...W,L])),S.ep){const W=k==="w"?I:C;g(W)?ts(rs=>[...rs,W]):ns(rs=>[...rs,W])}return o(R),e(O),h(Y),m(_),p(null),r([]),hs({from:S.from,to:S.to}),ms(W=>[...W,S]),X(R,_,O,Y).length===0?fs(R,_)?a("checkmate"):a("stalemate"):fs(R,_)?a("check"):a("playing"),{nb:R,nc:O,nep:Y,nextTurn:_}},[k]);N.useEffect(()=>{if(k!=="b"||i==="checkmate"||i==="stalemate"||U.current)return;U.current=!0,P(!0);const u=ws[l].depth,x=setTimeout(()=>{const{move:v}=us(s,f,t,u,-1/0,1/0,!1,"b");v&&V(s,f,t,v),P(!1),U.current=!1},50);return()=>clearTimeout(x)},[k,s,f,t,i,l,V]);const Ns=u=>{if(k!=="w"||B||i==="checkmate"||i==="stalemate"||F)return;const x=s[u];if(d!==null){const v=n.find(S=>S.to===u);if(v){const S=s[d],[L]=Z(u);if(S===C&&L===0){cs({from:d,to:u});return}V(s,f,t,v);return}if(g(x)){p(u),r(X(s,"w",f,t).filter(S=>S.from===u));return}p(null),r([]);return}g(x)&&(p(u),r(X(s,"w",f,t).filter(v=>v.from===u)))},gs=u=>{if(!F)return;const x={from:F.from,to:F.to,promo:u};cs(null),V(s,f,t,x)},Ss=new Set(n.map(u=>u.to));return c.jsxs("div",{className:"chess-root",children:[c.jsxs("div",{className:"chess-sidebar",children:[c.jsx("h1",{children:"♚ Chess"}),c.jsxs("div",{className:"chess-diff",children:[c.jsx("label",{children:"AI Difficulty"}),c.jsx("div",{className:"chess-diff-btns",children:ws.map((u,x)=>c.jsx("button",{className:x===l?"active":"",onClick:()=>{j(x),os()},children:u.label},u.label))})]}),c.jsxs("div",{className:"chess-captured",children:[c.jsxs("div",{className:"chess-cap-row",children:[c.jsx("span",{className:"chess-cap-label",children:"Captured by you:"}),c.jsx("span",{className:"chess-cap-pieces",children:xs.map((u,x)=>c.jsx("span",{children:z[u]},x))})]}),c.jsxs("div",{className:"chess-cap-row",children:[c.jsx("span",{className:"chess-cap-label",children:"Captured by AI:"}),c.jsx("span",{className:"chess-cap-pieces",children:es.map((u,x)=>c.jsx("span",{children:z[u]},x))})]})]}),c.jsxs("div",{className:"chess-status",children:[i==="check"&&c.jsx("span",{className:"chess-check",children:"Check!"}),i==="checkmate"&&c.jsx("span",{className:"chess-mate",children:k==="w"?"Checkmate — AI wins!":"Checkmate — You win!"}),i==="stalemate"&&c.jsx("span",{className:"chess-stale",children:"Stalemate — Draw!"}),B&&c.jsx("span",{className:"chess-thinking",children:"AI thinking…"}),i==="playing"&&!B&&k==="w"&&c.jsx("span",{className:"chess-your-turn",children:"Your turn (White)"})]}),c.jsx("div",{className:"chess-moves-log",children:c.jsxs("label",{children:["Moves: ",js.length]})}),c.jsx("button",{className:"chess-reset",onClick:os,children:"New Game"})]}),c.jsxs("div",{className:"chess-board-area",children:[c.jsx("div",{className:"chess-board",children:s.map((u,x)=>{const[v,S]=Z(x),L=(v+S)%2===1,R=Ss.has(x),O=d===x,Y=Q&&Q.from===x,_=Q&&Q.to===x,ps=(i==="check"||i==="checkmate")&&(u===D&&k==="w"||u===$&&k==="b");return c.jsxs("div",{className:`chess-sq ${L?"dark":"light"} ${O?"selected":""} ${Y||_?"last-move":""} ${ps?"in-check":""}`,onClick:()=>Ns(x),children:[S===0&&c.jsx("span",{className:"chess-rank-label",children:8-v}),v===7&&c.jsx("span",{className:"chess-file-label",children:"abcdefgh"[S]}),R&&c.jsx("div",{className:`chess-legal-dot ${u!==w?"capture":""}`}),u!==w&&c.jsx("span",{className:`chess-piece ${g(u)?"white":"black"}`,children:z[u]})]},x)})}),F&&c.jsx("div",{className:"chess-promo-overlay",children:c.jsxs("div",{className:"chess-promo-dialog",children:[c.jsx("p",{children:"Promote to:"}),c.jsx("div",{className:"chess-promo-options",children:[q,y,T,M].map(u=>c.jsx("button",{onClick:()=>gs(u),children:z[u]},u))})]})})]}),(i==="checkmate"||i==="stalemate")&&c.jsxs("div",{className:"chess-game-over",children:[c.jsx("h2",{children:i==="checkmate"?k==="w"?"♚ AI Wins!":"♔ You Win!":"½ Draw"}),c.jsx("p",{children:i==="checkmate"?"Checkmate":"Stalemate"}),c.jsx("button",{onClick:os,children:"Play Again"})]}),c.jsx(Cs,{})]})}export{Ds as default};
