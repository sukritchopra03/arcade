import{r as l,j as c}from"./index-CRqe24Pj.js";import{B as z}from"./BackButton-DJX8SMkP.js";const h=10,x=20,s=30,H=[[[1,1,1,1]],[[1,1],[1,1]],[[0,1,0],[1,1,1]],[[1,0,0],[1,1,1]],[[0,0,1],[1,1,1]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]]],E=["#00e5ff","#ffd740","#ce93d8","#ff6e40","#448aff","#69f0ae","#ff5252"];function I(){return Array.from({length:x},()=>Array(h).fill(0))}function J(v){return v[0].map((w,g)=>v.map(A=>A[g]).reverse())}function V(){const v=l.useRef(null),[w,g]=l.useState(0),[A,O]=l.useState(0),[N,M]=l.useState(1),[T,B]=l.useState(!1),[U,D]=l.useState(!1),i=l.useRef(I()),a=l.useRef(null),u=l.useRef({x:0,y:0}),S=l.useRef(0),C=l.useRef(0),b=l.useRef(0),L=l.useRef(1),y=l.useRef(!1),m=l.useRef(!1),F=l.useRef(null),j=l.useCallback(()=>{const e=Math.floor(Math.random()*H.length);a.current=H[e].map(t=>[...t]),S.current=e,u.current={x:Math.floor(h/2)-Math.floor(a.current[0].length/2),y:0},p(i.current,a.current,u.current)&&(y.current=!0,B(!0))},[]);function p(e,t,r){for(let n=0;n<t.length;n++)for(let o=0;o<t[n].length;o++)if(t[n][o]){const f=r.y+n,d=r.x+o;if(f<0||f>=x||d<0||d>=h||e[f][d])return!0}return!1}function W(e,t,r,n){const o=e.map(f=>[...f]);for(let f=0;f<t.length;f++)for(let d=0;d<t[f].length;d++)t[f][d]&&(o[r.y+f][r.x+d]=n+1);return o}function Z(e){let t=0;const r=e.filter(n=>n.every(o=>o)?(t++,!1):!0);for(;r.length<x;)r.unshift(Array(h).fill(0));return{board:r,cleared:t}}const R=l.useCallback(()=>{if(y.current||m.current)return;const e={x:u.current.x,y:u.current.y+1};if(!p(i.current,a.current,e))u.current=e;else{i.current=W(i.current,a.current,u.current,S.current);const{board:t,cleared:r}=Z(i.current);i.current=t;const n=[0,100,300,500,800][r]*L.current;C.current+=n,b.current+=r;const o=Math.floor(b.current/10)+1;L.current=o,g(C.current),O(b.current),M(o),j()}},[j]),k=l.useCallback(()=>{var t;const e=(t=v.current)==null?void 0:t.getContext("2d");if(e){e.fillStyle="#0d1225",e.fillRect(0,0,h*s,x*s),e.strokeStyle="#1a2a44",e.lineWidth=.5;for(let r=0;r<=x;r++)e.beginPath(),e.moveTo(0,r*s),e.lineTo(h*s,r*s),e.stroke();for(let r=0;r<=h;r++)e.beginPath(),e.moveTo(r*s,0),e.lineTo(r*s,x*s),e.stroke();for(let r=0;r<x;r++)for(let n=0;n<h;n++)i.current[r][n]&&(e.fillStyle=E[i.current[r][n]-1],e.fillRect(n*s+1,r*s+1,s-2,s-2),e.fillStyle="rgba(255,255,255,0.15)",e.fillRect(n*s+1,r*s+1,s-2,4));if(a.current&&!y.current){e.fillStyle=E[S.current];for(let n=0;n<a.current.length;n++)for(let o=0;o<a.current[n].length;o++)if(a.current[n][o]){const f=(u.current.x+o)*s,d=(u.current.y+n)*s;e.fillRect(f+1,d+1,s-2,s-2),e.fillStyle="rgba(255,255,255,0.2)",e.fillRect(f+1,d+1,s-2,4),e.fillStyle=E[S.current]}let r=u.current.y;for(;!p(i.current,a.current,{x:u.current.x,y:r+1});)r++;if(r!==u.current.y){e.globalAlpha=.2;for(let n=0;n<a.current.length;n++)for(let o=0;o<a.current[n].length;o++)a.current[n][o]&&e.fillRect((u.current.x+o)*s+1,(r+n)*s+1,s-2,s-2);e.globalAlpha=1}}}},[]),P=l.useCallback(e=>{if(y.current||m.current)return;const t={x:u.current.x+e,y:u.current.y};p(i.current,a.current,t)||(u.current=t)},[]),q=l.useCallback(()=>{if(y.current||m.current)return;const e=J(a.current);if(!p(i.current,e,u.current))a.current=e;else for(const t of[1,-1,2,-2]){const r={x:u.current.x+t,y:u.current.y};if(!p(i.current,e,r)){a.current=e,u.current=r;return}}},[]),G=l.useCallback(()=>{if(!(y.current||m.current)){for(;!p(i.current,a.current,{x:u.current.x,y:u.current.y+1});)u.current={x:u.current.x,y:u.current.y+1};R()}},[R]),_=()=>{i.current=I(),C.current=0,b.current=0,L.current=1,y.current=!1,m.current=!1,g(0),O(0),M(1),B(!1),D(!1),j()};return l.useEffect(()=>{j();const e=()=>{k(),requestAnimationFrame(e)},t=requestAnimationFrame(e);return()=>cancelAnimationFrame(t)},[j,k]),l.useEffect(()=>{const e=Math.max(100,800-(N-1)*70);return F.current=setInterval(R,e),()=>clearInterval(F.current)},[R,N]),l.useEffect(()=>{const e=t=>{t.key==="ArrowLeft"?P(-1):t.key==="ArrowRight"?P(1):t.key==="ArrowDown"?R():t.key==="ArrowUp"?q():t.key===" "?G():(t.key==="p"||t.key==="P")&&(m.current=!m.current,D(r=>!r)),k()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[P,R,q,G,k]),c.jsxs("div",{className:"tetris-root",children:[c.jsxs("div",{className:"tetris-side",children:[c.jsx("h1",{children:"Tetris"}),c.jsxs("div",{className:"tetris-stat",children:[c.jsx("label",{children:"Score"}),c.jsx("span",{children:w})]}),c.jsxs("div",{className:"tetris-stat",children:[c.jsx("label",{children:"Lines"}),c.jsx("span",{children:A})]}),c.jsxs("div",{className:"tetris-stat",children:[c.jsx("label",{children:"Level"}),c.jsx("span",{children:N})]}),U&&c.jsx("p",{className:"tetris-paused",children:"PAUSED"}),c.jsxs("div",{className:"tetris-controls",children:[c.jsx("p",{children:"← → Move"}),c.jsx("p",{children:"↑ Rotate"}),c.jsx("p",{children:"↓ Soft drop"}),c.jsx("p",{children:"Space Hard drop"}),c.jsx("p",{children:"P Pause"})]}),T&&c.jsx("button",{className:"tetris-restart",onClick:_,children:"Play Again"})]}),c.jsxs("div",{className:"tetris-board-wrap",children:[c.jsx("canvas",{ref:v,width:h*s,height:x*s,className:"tetris-canvas"}),T&&c.jsxs("div",{className:"tetris-over",children:[c.jsx("h2",{children:"Game Over"}),c.jsxs("p",{children:["Score: ",w]})]})]}),c.jsx(z,{})]})}export{V as default};
