import{r as h,j as e}from"./index-DxoVmnoF.js";import{B as Y}from"./BackButton-rhTEpRQT.js";const q=["â™ ","â™¥","â™¦","â™£"],B=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],z={"â™ ":"#e0e0e0","â™¥":"#ff5252","â™¦":"#ff5252","â™£":"#e0e0e0"},K=d=>B.indexOf(d),$=d=>{const a=K(d);return a===0?1:a>=10?10:a+1};function W(){const d=[];for(const a of q)for(const t of B)d.push({rank:t,suit:a,id:`${t}${a}`});for(let a=d.length-1;a>0;a--){const t=Math.floor(Math.random()*(a+1));[d[a],d[t]]=[d[t],d[a]]}return d}function R(d){const a=[],t={};d.forEach((r,l)=>{t[r.rank]||(t[r.rank]=[]),t[r.rank].push(l)});for(const r in t)t[r].length>=3&&a.push({type:"set",indices:t[r].slice(0,3)});const m={};d.forEach((r,l)=>{m[r.suit]||(m[r.suit]=[]),m[r.suit].push({idx:l,rv:K(r.rank)})});for(const r in m){const l=m[r].sort((i,v)=>i.rv-v.rv);for(let i=0;i<=l.length-3;i++)l[i+1].rv===l[i].rv+1&&l[i+2].rv===l[i+1].rv+1&&a.push({type:"run",indices:[l[i].idx,l[i+1].idx,l[i+2].idx]})}return a}function O(d,a){const t=new Set(a.flat());return d.reduce((m,r,l)=>t.has(l)?m:m+$(r.rank),0)}function ss(){const[d,a]=h.useState("menu"),[t,m]=h.useState([]),[r,l]=h.useState([]),[i,v]=h.useState([]),[j,k]=h.useState([]),[A,w]=h.useState(new Set),[y,D]=h.useState("player"),[E,f]=h.useState(""),[S,F]=h.useState({p:0,a:0}),[b,I]=h.useState(!1),P=h.useCallback(()=>{const s=W(),n=s.slice(0,7),o=s.slice(7,14),c=[s[14]],u=s.slice(15);m(n),l(o),v(u),k(c),w(new Set),D("player"),f("Draw a card"),I(!1),a("playing")},[]),G=()=>{if(y!=="player"||i.length===0)return;const s=[...i],n=s.pop();v(s),m(o=>[...o,n]),f("Discard a card")},U=()=>{if(y!=="player"||j.length===0)return;const s=[...j],n=s.pop();k(s),m(o=>[...o,n]),f("Discard a card")},J=s=>{if(t.length<=7)return;const n=[...t],o=n.splice(s,1)[0];m(n),k(c=>[...c,o]),w(new Set),f(""),setTimeout(()=>L(n,i,j.concat(o)),400)},L=(s,n,o)=>{D("ai");let c=[...r],u=[...n],p=[...o];p.length>0&&Math.random()<.4?c.push(p.pop()):(u.length>0||(u=[...p.reverse()],p=[]),c.push(u.pop()));const x=R(c),M=new Set(x.flatMap(N=>N.indices));let g=-1,H=-1;c.forEach((N,T)=>{!M.has(T)&&$(N.rank)>H&&(H=$(N.rank),g=T)}),g===-1&&(g=c.length-1);const _=c.splice(g,1)[0];p.push(_),l(c),v(u),k(p),D("player"),f("Draw a card")},Q=()=>{const s=R(t);s.length>0&&s.reduce((x,M)=>[...x,...M.indices],[]);const n=O(t,s.map(x=>x.indices)),o=R(r),c=O(r,o.map(x=>x.indices));let u=S.p,p=S.a;n<=c?(u+=c-n+10,f(`You knock! Deadwood ${n} vs ${c}. You win the round!`)):(p+=n-c+10,f(`You knock! Deadwood ${n} vs ${c}. AI wins the round!`)),F({p:u,a:p}),I(!0),a("result")},V=s=>{const n=new Set(A);n.has(s)?n.delete(s):n.add(s),w(n)},C=(s,n,o,c=!1,u=!1)=>u?e.jsx("div",{className:"rm-card facedown",children:"ðŸ‚ "},s.id):e.jsxs("div",{className:`rm-card faceup ${c?"sel":""}`,style:{color:z[s.suit]},onClick:()=>o&&o(n),children:[e.jsx("span",{className:"rm-r",children:s.rank}),e.jsx("span",{className:"rm-s",children:s.suit})]},s.id);return d==="menu"?e.jsxs("div",{className:"rm-menu",children:[e.jsx("h1",{children:"ðŸƒ Rummy"}),e.jsx("p",{children:"Gin Rummy â€” 7-card"}),e.jsx("button",{onClick:P,children:"Deal"}),e.jsx(Y,{})]}):e.jsxs("div",{className:"rm-root",children:[e.jsxs("div",{className:"rm-scores",children:["You: ",S.p," Â |Â  AI: ",S.a]}),e.jsxs("div",{className:"rm-ai-area",children:[e.jsxs("div",{className:"rm-label",children:["AI (",r.length," cards)"]}),e.jsx("div",{className:"rm-hand",children:r.map((s,n)=>C(s,n,null,!1,!b))})]}),e.jsxs("div",{className:"rm-mid",children:[e.jsx("div",{className:"rm-pile",onClick:G,children:i.length>0?e.jsxs("div",{className:"rm-card facedown",children:["ðŸ‚ ",e.jsx("br",{}),e.jsx("small",{children:i.length})]}):e.jsx("div",{className:"rm-empty",children:"Empty"})}),e.jsx("div",{className:"rm-discard-pile",onClick:U,children:j.length>0?C(j[j.length-1],-1):e.jsx("div",{className:"rm-empty",children:"Discard"})})]}),E&&e.jsx("div",{className:"rm-msg",children:E}),e.jsxs("div",{className:"rm-player-area",children:[e.jsx("div",{className:"rm-label",children:"Your Hand"}),e.jsx("div",{className:"rm-hand",children:t.map((s,n)=>C(s,n,t.length>7?J:V,A.has(n)))})]}),e.jsxs("div",{className:"rm-btns",children:[!b&&e.jsx("button",{onClick:Q,disabled:y!=="player",children:"Knock"}),b&&e.jsx("button",{onClick:P,children:"Next Round"})]}),e.jsx(Y,{})]})}export{ss as default};
